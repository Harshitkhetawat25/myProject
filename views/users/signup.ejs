<% layout("layouts/boilerplate") %>
<style>
    .password-feedback {
        font-size: 0.8rem;
        color: #dc3545;
        margin-top: 0.25rem;
    }
    .password-feedback.valid {
        color: #28a745;
    }
    @media (max-width: 767.98px) {
        .password-feedback {
            font-size: 0.7rem;
        }
        .form-control {
            font-size: 0.9rem;
            padding: 0.5rem;
        }
        .form-label {
            font-size: 0.9rem;
        }
        .col-6.offset-3 {
            padding: 0 0.5rem;
        }
        .btn-dark {
            padding: 0.5rem;
            font-size: 0.9rem;
        }
    }
</style>
<div class="row mt-3">
    <div class="col-6 offset-3">
        <h1 class="col-6 offset-3">SignUp on WanderWhirl</h1>
        <form action="/signup" method="POST" class="needs-validation" novalidate>
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" name="username" id="username" class="form-control" required>
                <div class="invalid-feedback">Please enter a username</div>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" name="email" id="email" class="form-control" required>
                <div class="invalid-feedback">Please enter a valid email</div>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" name="password" id="password" class="form-control" required>
                <div class="invalid-feedback">Please enter a password</div>
                <div id="passwordFeedback">
                    <div class="password-feedback" id="length">At least 8 characters</div>
                    <div class="password-feedback" id="uppercase">One uppercase letter</div>
                    <div class="password-feedback" id="lowercase">One lowercase letter</div>
                    <div class="password-feedback" id="number">One number</div>
                </div>
            </div>
            <button class="btn btn-dark" disabled>SignUp</button>
        </form>
    </div>
</div>

<script>
    console.log("Signup form script loaded"); // Debug log
    const passwordInput = document.getElementById('password');
    const lengthFeedback = document.getElementById('length');
    const uppercaseFeedback = document.getElementById('uppercase');
    const lowercaseFeedback = document.getElementById('lowercase');
    const numberFeedback = document.getElementById('number');
    const form = document.querySelector('.needs-validation');
    const submitButton = form.querySelector('button');

    function validatePassword() {
        const password = passwordInput.value;
        console.log("Password input:", password); // Debug log

        // Check length
        const isLengthValid = password.length >= 8;
        lengthFeedback.classList.toggle('valid', isLengthValid);
        lengthFeedback.textContent = isLengthValid ? '✓ At least 8 characters' : 'At least 8 characters';

        // Check uppercase
        const isUppercaseValid = /[A-Z]/.test(password);
        uppercaseFeedback.classList.toggle('valid', isUppercaseValid);
        uppercaseFeedback.textContent = isUppercaseValid ? '✓ One uppercase letter' : 'One uppercase letter';

        // Check lowercase
        const isLowercaseValid = /[a-z]/.test(password);
        lowercaseFeedback.classList.toggle('valid', isLowercaseValid);
        lowercaseFeedback.textContent = isLowercaseValid ? '✓ One lowercase letter' : 'One lowercase letter';

        // Check number
        const isNumberValid = /\d/.test(password);
        numberFeedback.classList.toggle('valid', isNumberValid);
        numberFeedback.textContent = isNumberValid ? '✓ One number' : 'One number';

        // Enable/disable submit button
        const isValid = isLengthValid && isUppercaseValid && isLowercaseValid && isNumberValid;
        submitButton.disabled = !isValid;
        console.log("Form valid:", isValid); // Debug log
    }

    passwordInput.addEventListener('input', validatePassword);

    // Bootstrap validation
    form.addEventListener('submit', (event) => {
        console.log("Form submit attempted"); // Debug log
        if (!form.checkValidity() || submitButton.disabled) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });

    // Initial validation
    validatePassword();
</script>